<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nmedea</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,700;9..40,800&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}

        body{
            font-family:'DM Sans',sans-serif;
            background:#0b0b0b;
            color:#f3f3ee;
            min-height:100dvh;
            display:flex;
            flex-direction:column;
            align-items:center;
            justify-content:center;
            padding:24px;
            transition:background 0.5s;
        }

        body.light{
            background:#f3f3ee;
            color:#0b0b0b;
        }

        /* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
        .screen{
            display:none;
            width:100%;
            max-width:360px;
            flex-direction:column;
            align-items:center;
            gap:20px;
        }
        .screen.active{
            display:flex;
            animation:fadeUp 0.4s ease;
        }
        @keyframes fadeUp{
            from{opacity:0;transform:translateY(14px);}
            to{opacity:1;transform:translateY(0);}
        }

        /* ‚îÄ‚îÄ LOGO ‚îÄ‚îÄ */
        .logo{
            font-family:'Bebas Neue',sans-serif;
            font-size:38px;
            letter-spacing:7px;
        }
        .logo.dark-logo{color:#f3f3ee;}
        .logo.light-logo{color:#0b0b0b;}

        .tagline{
            font-size:11px;
            letter-spacing:3px;
            text-transform:uppercase;
            opacity:0.35;
            margin-top:-16px;
            text-align:center;
        }

        /* ‚îÄ‚îÄ BOOT / SECURITY SCREEN ‚îÄ‚îÄ */
        #s-boot{
            gap:28px;
        }

        .boot-logo{
            font-family:'Bebas Neue',sans-serif;
            font-size:52px;
            letter-spacing:10px;
            color:#f3f3ee;
            animation:glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow{
            from{text-shadow:0 0 10px rgba(243,243,238,0.2);}
            to{text-shadow:0 0 30px rgba(243,243,238,0.5),0 0 60px rgba(243,243,238,0.2);}
        }

        .boot-tagline{
            font-size:10px;
            letter-spacing:5px;
            text-transform:uppercase;
            color:rgba(243,243,238,0.3);
            margin-top:-20px;
            text-align:center;
        }

        .check-list{
            width:100%;
            display:flex;
            flex-direction:column;
            gap:10px;
        }

        .check-item{
            display:flex;
            align-items:center;
            gap:12px;
            font-size:13px;
            letter-spacing:0.5px;
            color:rgba(243,243,238,0.25);
            transition:color 0.3s;
            padding:2px 0;
        }

        .check-item.running{color:rgba(243,243,238,0.7);}
        .check-item.done{color:#f3f3ee;}
        .check-item.fail{color:#ef4444;}

        .check-icon{
            width:20px;height:20px;
            border-radius:50%;
            border:1.5px solid rgba(243,243,238,0.15);
            display:flex;align-items:center;justify-content:center;
            font-size:10px;
            flex-shrink:0;
            transition:all 0.3s;
        }
        .check-item.running .check-icon{
            border-color:rgba(243,243,238,0.5);
            animation:spin 0.8s linear infinite;
        }
        .check-item.done .check-icon{
            background:#f3f3ee;
            border-color:#f3f3ee;
            color:#0b0b0b;
            font-size:11px;
        }
        .check-item.fail .check-icon{
            background:#ef4444;
            border-color:#ef4444;
            color:#fff;
        }
        @keyframes spin{to{transform:rotate(360deg);}}

        .boot-bar-wrap{
            width:100%;
            height:2px;
            background:rgba(243,243,238,0.1);
            border-radius:2px;
            overflow:hidden;
        }
        .boot-bar{
            height:100%;
            width:0%;
            background:#f3f3ee;
            border-radius:2px;
            transition:width 0.4s ease;
        }

        .boot-status{
            font-size:11px;
            letter-spacing:2px;
            text-transform:uppercase;
            color:rgba(243,243,238,0.3);
            text-align:center;
            min-height:16px;
        }

        /* ‚îÄ‚îÄ STEPS ‚îÄ‚îÄ */
        .steps{display:flex;align-items:center;width:100%;}
        .step-dot{
            width:28px;height:28px;border-radius:50%;
            background:rgba(11,11,11,0.1);
            display:flex;align-items:center;justify-content:center;
            font-size:11px;font-weight:800;
            color:rgba(11,11,11,0.3);
            flex-shrink:0;transition:all 0.3s;
        }
        .step-dot.active{background:#0b0b0b;color:#f3f3ee;}
        .step-dot.done{background:#16a34a;color:#fff;}
        .step-line{
            flex:1;height:2px;
            background:rgba(11,11,11,0.1);
            transition:background 0.3s;
        }
        .step-line.done{background:#16a34a;}

        /* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
        .card{
            width:100%;background:#fff;
            border-radius:16px;
            padding:28px 24px;
            display:flex;flex-direction:column;gap:16px;
            box-shadow:0 2px 24px rgba(11,11,11,0.07);
        }
        .card-title{
            font-family:'Bebas Neue',sans-serif;
            font-size:22px;letter-spacing:3px;color:#0b0b0b;
        }
        .card-sub{
            font-size:13px;color:rgba(11,11,11,0.45);
            margin-top:-10px;line-height:1.5;
        }

        /* ‚îÄ‚îÄ FIELDS ‚îÄ‚îÄ */
        .field{display:flex;flex-direction:column;gap:6px;}

        label{
            font-size:11px;letter-spacing:2px;
            text-transform:uppercase;
            color:rgba(11,11,11,0.4);font-weight:700;
        }

        .input-wrap{position:relative;}

        input[type=text],
        input[type=email],
        input[type=password]{
            width:100%;padding:14px 16px;
            background:#f3f3ee;
            border:1.5px solid transparent;
            border-radius:10px;
            font-family:'DM Sans',sans-serif;
            font-size:15px;color:#0b0b0b;
            outline:none;
            transition:border-color 0.2s,background 0.2s;
        }
        input.has-toggle{padding-right:48px;}
        input:focus{border-color:#0b0b0b;background:#fff;}
        input::placeholder{color:rgba(11,11,11,0.25);}

        .eye-btn{
            position:absolute;right:14px;top:50%;
            transform:translateY(-50%);
            background:none;border:none;cursor:pointer;
            color:rgba(11,11,11,0.35);font-size:16px;
            padding:4px;line-height:1;
        }

        /* ‚îÄ‚îÄ PASSWORD STRENGTH ‚îÄ‚îÄ */
        .strength-bar{display:flex;gap:4px;margin-top:2px;}
        .strength-seg{
            flex:1;height:3px;border-radius:4px;
            background:rgba(11,11,11,0.1);
            transition:background 0.3s;
        }
        .strength-label{font-size:11px;letter-spacing:1px;margin-top:2px;min-height:14px;}

        .suggest-btn{
            display:flex;align-items:center;gap:6px;
            background:rgba(11,11,11,0.04);
            border:1.5px dashed rgba(11,11,11,0.15);
            border-radius:8px;padding:10px 14px;
            cursor:pointer;font-family:'DM Sans',sans-serif;
            font-size:12px;color:rgba(11,11,11,0.5);
            letter-spacing:0.5px;width:100%;text-align:left;
            transition:all 0.2s;
        }
        .suggest-btn:hover{border-color:rgba(11,11,11,0.3);color:#0b0b0b;}

        .suggested-pw{
            display:none;
            background:rgba(11,11,11,0.04);
            border:1.5px solid rgba(11,11,11,0.1);
            border-radius:8px;padding:10px 14px;
            font-size:13px;font-weight:700;letter-spacing:1px;
            color:#0b0b0b;word-break:break-all;cursor:pointer;
        }
        .suggested-pw.visible{display:block;}

        .pw-hint{font-size:11px;color:rgba(11,11,11,0.35);text-align:center;}

        .req-list{display:flex;flex-direction:column;gap:4px;margin-top:2px;}
        .req{
            display:flex;align-items:center;gap:6px;
            font-size:11px;color:rgba(11,11,11,0.4);
            transition:color 0.2s;
        }
        .req.met{color:#16a34a;}
        .req .req-dot{
            width:6px;height:6px;border-radius:50%;
            background:rgba(11,11,11,0.15);flex-shrink:0;
            transition:background 0.2s;
        }
        .req.met .req-dot{background:#16a34a;}

        /* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
        .btn{
            width:100%;padding:16px;
            background:#0b0b0b;color:#f3f3ee;
            border:none;border-radius:10px;
            font-family:'DM Sans',sans-serif;
            font-size:13px;font-weight:800;
            letter-spacing:2px;text-transform:uppercase;
            cursor:pointer;
            transition:opacity 0.2s,transform 0.1s;
            margin-top:4px;
        }
        .btn:hover{opacity:0.85;}
        .btn:active{transform:scale(0.98);}
        .btn:disabled{opacity:0.35;cursor:not-allowed;transform:none;}
        .btn-ghost{
            background:transparent;
            color:rgba(11,11,11,0.45);
            border:1.5px solid rgba(11,11,11,0.12);
        }
        .btn-back{
            background:transparent;color:rgba(11,11,11,0.4);
            border:none;font-size:12px;letter-spacing:1px;
            cursor:pointer;display:flex;align-items:center;gap:4px;
            padding:0;width:auto;font-family:'DM Sans',sans-serif;
        }

        .divider{display:flex;align-items:center;gap:12px;}
        .divider span{
            font-size:11px;letter-spacing:2px;
            text-transform:uppercase;color:rgba(11,11,11,0.25);
            white-space:nowrap;
        }
        .divider::before,.divider::after{
            content:'';flex:1;height:1px;background:rgba(11,11,11,0.1);
        }

        .free-badge{
            display:inline-flex;align-items:center;gap:6px;
            background:#0b0b0b;color:#f3f3ee;
            font-size:10px;letter-spacing:2px;
            text-transform:uppercase;font-weight:800;
            padding:6px 14px;border-radius:100px;
        }
        .dot{
            width:6px;height:6px;background:#22c55e;
            border-radius:50%;animation:pulse 1.5s infinite;flex-shrink:0;
        }
        @keyframes pulse{
            0%,100%{opacity:1;transform:scale(1);}
            50%{opacity:0.4;transform:scale(0.7);}
        }

        .msg{font-size:13px;text-align:center;min-height:18px;}
        .msg.ok{color:#16a34a;}
        .msg.err{color:#dc2626;}
        .msg.info{color:#2563eb;}

        .forgot-link{
            font-size:12px;color:rgba(11,11,11,0.4);
            cursor:pointer;text-align:right;
        }
        .forgot-link:hover{color:#0b0b0b;}

        .spinner{
            display:inline-block;width:14px;height:14px;
            border:2px solid rgba(243,243,238,0.3);
            border-top-color:#f3f3ee;
            border-radius:50%;
            animation:spin2 0.6s linear infinite;
            vertical-align:middle;margin-right:6px;
        }
        @keyframes spin2{to{transform:rotate(360deg);}}

        .success-icon{
            width:64px;height:64px;background:#16a34a;
            border-radius:50%;
            display:flex;align-items:center;justify-content:center;
            font-size:28px;color:white;
            animation:popIn 0.4s cubic-bezier(0.175,0.885,0.32,1.275);
        }
        @keyframes popIn{
            from{transform:scale(0);opacity:0;}
            to{transform:scale(1);opacity:1;}
        }

        /* device id badge */
        .device-badge{
            display:flex;align-items:center;gap:8px;
            background:rgba(11,11,11,0.04);
            border:1px solid rgba(11,11,11,0.08);
            border-radius:8px;padding:10px 14px;
            font-size:11px;color:rgba(11,11,11,0.4);
            letter-spacing:0.5px;
            word-break:break-all;
        }
        .device-badge strong{
            color:#0b0b0b;font-size:10px;
            letter-spacing:1px;text-transform:uppercase;
            flex-shrink:0;
        }
    </style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     BOOT / SECURITY CHECK SCREEN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="s-boot">
    <div class="boot-logo">nmedea</div>
    <div class="boot-tagline">Secure Internet Access</div>

    <div class="check-list" id="check-list">
        <div class="check-item" id="chk-device">
            <div class="check-icon">¬∑</div>
            <span>Reading device identity</span>
        </div>
        <div class="check-item" id="chk-session">
            <div class="check-icon">¬∑</div>
            <span>Checking saved session</span>
        </div>
        <div class="check-item" id="chk-token">
            <div class="check-icon">¬∑</div>
            <span>Verifying access token</span>
        </div>
        <div class="check-item" id="chk-sub">
            <div class="check-icon">¬∑</div>
            <span>Checking subscription status</span>
        </div>
        <div class="check-item" id="chk-sync">
            <div class="check-icon">¬∑</div>
            <span>Syncing with nmedea network</span>
        </div>
        <div class="check-item" id="chk-security">
            <div class="check-icon">¬∑</div>
            <span>Applying security protocols</span>
        </div>
    </div>

    <div class="boot-bar-wrap">
        <div class="boot-bar" id="boot-bar"></div>
    </div>
    <div class="boot-status" id="boot-status">Initialising...</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     LOGIN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen active" id="s-login">
    <div class="logo light-logo">nmedea</div>
    <div class="tagline">Your internet. Your way.</div>
    <div class="card">
        <div class="card-title">Welcome Back</div>
        <div class="card-sub">Sign in to continue to your internet.</div>
        <div class="field">
            <label>Email</label>
            <input type="email" id="l-email" placeholder="you@example.com" autocomplete="email"/>
        </div>
        <div class="field">
            <label>Password</label>
            <div class="input-wrap">
                <input type="password" id="l-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="has-toggle" autocomplete="current-password"/>
                <button class="eye-btn" onclick="toggleEye('l-pass',this)" type="button">üëÅ</button>
            </div>
        </div>
        <div class="forgot-link" onclick="show('s-forgot')">Forgot password?</div>
        <button class="btn" id="l-btn" onclick="doLogin()">Sign In</button>
        <div class="divider"><span>new to nmedea</span></div>
        <button class="btn btn-ghost" onclick="show('s-reg1')">Create Account</button>
    </div>
    <div class="msg" id="l-msg"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     REGISTER STEP 1
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="s-reg1">
    <div class="logo light-logo">nmedea</div>
    <div class="tagline">Create your account</div>
    <div class="steps">
        <div class="step-dot active">1</div>
        <div class="step-line"></div>
        <div class="step-dot">2</div>
        <div class="step-line"></div>
        <div class="step-dot">3</div>
    </div>
    <div class="card">
        <div class="card-title">Your Details</div>
        <div class="card-sub">Start with your basic info.</div>
        <div class="field">
            <label>Full Name</label>
            <input type="text" id="r-name" placeholder="Your full name" autocomplete="name"/>
        </div>
        <div class="field">
            <label>Email</label>
            <input type="email" id="r-email" placeholder="you@example.com" autocomplete="email"/>
        </div>
        <button class="btn" id="r1-btn" onclick="doStep1()">Continue</button>
    </div>
    <div class="msg" id="r1-msg"></div>
    <button class="btn-back" onclick="show('s-login')">‚Üê Back to Sign In</button>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     REGISTER STEP 2
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="s-reg2">
    <div class="logo light-logo">nmedea</div>
    <div class="tagline">Create your account</div>
    <div class="steps">
        <div class="step-dot done">‚úì</div>
        <div class="step-line done"></div>
        <div class="step-dot active">2</div>
        <div class="step-line"></div>
        <div class="step-dot">3</div>
    </div>
    <div class="card">
        <div class="card-title">Create Password</div>
        <div class="card-sub">We recommend a strong password.</div>

        <button class="suggest-btn" onclick="generatePassword()" type="button">
            üîë &nbsp;Suggest a strong password
        </button>
        <div class="suggested-pw" id="suggested-pw" onclick="useSuggestedPw()"></div>
        <div class="pw-hint" id="pw-hint" style="display:none;">Tap to use ‚Äî saved on your device</div>

        <div class="field">
            <label>Password</label>
            <div class="input-wrap">
                <input type="password" id="r-pass" placeholder="Min 8 characters" class="has-toggle"
                    autocomplete="new-password" oninput="checkStrength(this.value)"/>
                <button class="eye-btn" onclick="toggleEye('r-pass',this)" type="button">üëÅ</button>
            </div>
            <div class="strength-bar">
                <div class="strength-seg" id="seg1"></div>
                <div class="strength-seg" id="seg2"></div>
                <div class="strength-seg" id="seg3"></div>
                <div class="strength-seg" id="seg4"></div>
            </div>
            <div class="strength-label" id="strength-label"></div>
            <div class="req-list">
                <div class="req" id="req-len"><div class="req-dot"></div>At least 8 characters</div>
                <div class="req" id="req-upper"><div class="req-dot"></div>One uppercase letter (A-Z)</div>
                <div class="req" id="req-num"><div class="req-dot"></div>One number (0-9)</div>
                <div class="req" id="req-sym"><div class="req-dot"></div>One symbol (!@#$...)</div>
            </div>
        </div>

        <div class="field">
            <label>Confirm Password</label>
            <div class="input-wrap">
                <input type="password" id="r-pass2" placeholder="Repeat password" class="has-toggle" autocomplete="new-password"/>
                <button class="eye-btn" onclick="toggleEye('r-pass2',this)" type="button">üëÅ</button>
            </div>
        </div>
        <button class="btn" id="r2-btn" onclick="doStep2()">Continue</button>
    </div>
    <div class="msg" id="r2-msg"></div>
    <button class="btn-back" onclick="show('s-reg1')">‚Üê Back</button>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     REGISTER STEP 3
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="s-reg3">
    <div class="logo light-logo">nmedea</div>
    <div class="tagline">Almost done!</div>
    <div class="steps">
        <div class="step-dot done">‚úì</div>
        <div class="step-line done"></div>
        <div class="step-dot done">‚úì</div>
        <div class="step-line done"></div>
        <div class="step-dot active">3</div>
    </div>
    <div class="card">
        <div class="card-title">You're Ready</div>
        <div class="card-sub">Your device has been registered. Claim your 15 minutes of free internet now.</div>
        <div class="free-badge" style="margin:4px auto;">
            <span class="dot"></span>
            15 minutes free ‚Äî waiting for you
        </div>
        <div class="device-badge" id="device-badge-display">
            <strong>Device ID</strong>
            <span id="device-id-display">Generating...</span>
        </div>
        <button class="btn" id="r3-btn" onclick="doCreateAccount()">Claim Free Access</button>
    </div>
    <div class="msg" id="r3-msg"></div>
    <button class="btn-back" onclick="show('s-reg2')">‚Üê Back</button>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SUCCESS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="s-success">
    <div class="success-icon">‚úì</div>
    <div class="logo light-logo">nmedea</div>
    <div class="tagline">You're connected!</div>
    <div class="card" style="text-align:center;gap:12px;">
        <div class="card-title">Welcome to nmedea</div>
        <div class="card-sub">Your 15 minutes of free internet starts now. Enjoy the experience!</div>
        <div class="free-badge" style="margin:4px auto;">
            <span class="dot"></span>
            15:00 free ‚Äî starting now
        </div>
        <button class="btn" onclick="location.replace('dashboard.html')" style="margin-top:8px;">
            Enter Dashboard
        </button>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     FORGOT PASSWORD
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="s-forgot">
    <div class="logo light-logo">nmedea</div>
    <div class="tagline">Reset your password</div>
    <div class="card">
        <div class="card-title">Forgot Password</div>
        <div class="card-sub">Enter your email and we'll send a reset link.</div>
        <div class="field">
            <label>Email</label>
            <input type="email" id="f-email" placeholder="you@example.com"/>
        </div>
        <button class="btn" id="f-btn" onclick="doForgot()">Send Reset Link</button>
        <button class="btn btn-ghost" onclick="show('s-login')">Back to Sign In</button>
    </div>
    <div class="msg" id="f-msg"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCRIPTS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script>

    /* ‚ïê‚ïê SCREEN SWITCH ‚ïê‚ïê */
    window.show = id => {
        document.body.classList.add('light');
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    };

    /* ‚ïê‚ïê EYE TOGGLE ‚ïê‚ïê */
    window.toggleEye = (inputId, btn) => {
        const el = document.getElementById(inputId);
        el.type = el.type === 'password' ? 'text' : 'password';
        btn.textContent = el.type === 'password' ? 'üëÅ' : 'üôà';
    };

    /* ‚ïê‚ïê DEVICE FINGERPRINT ‚ïê‚ïê */
    window.getDeviceID = () => {
        try {
            const saved = localStorage.getItem('nmedea_device_id');
            if (saved) return saved;
        } catch(e) {}

        const raw = [
            navigator.userAgent,
            navigator.language,
            screen.width + 'x' + screen.height,
            screen.colorDepth,
            new Date().getTimezoneOffset(),
            navigator.hardwareConcurrency || 'unk',
            navigator.deviceMemory || 'unk',
            navigator.platform || 'unk',
            navigator.maxTouchPoints || '0'
        ].join('||');

        // Hash it
        let h = 5381;
        for (let i = 0; i < raw.length; i++) {
            h = ((h << 5) + h) ^ raw.charCodeAt(i);
            h = h >>> 0;
        }
        const deviceId = 'NM-' + h.toString(36).toUpperCase() + '-' + Date.now().toString(36).toUpperCase();

        try { localStorage.setItem('nmedea_device_id', deviceId); } catch(e) {}
        return deviceId;
    };

    /* ‚ïê‚ïê BOOT SEQUENCE ‚Äî REAL CHECKS ‚ïê‚ïê */
    async function runBoot() {
        const bar     = document.getElementById('boot-bar');
        const status  = document.getElementById('boot-status');

        const setCheck = (id, state, icon) => {
            const el  = document.getElementById(id);
            const ico = el.querySelector('.check-icon');
            el.className = 'check-item ' + state;
            ico.textContent = icon || (state === 'done' ? '‚úì' : state === 'fail' ? '‚úó' : '¬∑');
        };

        const progress = pct => { bar.style.width = pct + '%'; };
        const wait     = ms  => new Promise(r => setTimeout(r, ms));

        // Step 1 ‚Äî Read device identity (REAL)
        await wait(300);
        setCheck('chk-device','running','');
        status.textContent = 'Reading device identity...';
        const deviceId = window.getDeviceID();
        await wait(700);
        setCheck('chk-device','done');
        progress(17);

        // Step 2 ‚Äî Check saved session (REAL)
        await wait(200);
        setCheck('chk-session','running','');
        status.textContent = 'Checking saved session...';
        let session = null;
        try { session = JSON.parse(localStorage.getItem('nmedea_session') || 'null'); } catch(e) {}
        await wait(600);

        if (session && session.uid && session.token) {
            setCheck('chk-session','done');
            progress(34);

            // Step 3 ‚Äî Verify token (REAL ‚Äî check it exists and matches)
            await wait(200);
            setCheck('chk-token','running','');
            status.textContent = 'Verifying access token...';
            const tokenValid = session.token && session.token.length > 10;
            await wait(600);

            if (tokenValid) {
                setCheck('chk-token','done');
                progress(51);

                // Step 4 ‚Äî Check subscription (REAL ‚Äî check expiry)
                await wait(200);
                setCheck('chk-sub','running','');
                status.textContent = 'Checking subscription status...';
                let isSubscribed = session.subscribed;
                const now = Date.now();

                // If on free trial check expiry
                if (session.isFree && session.freeExpiry) {
                    const expiry = new Date(session.freeExpiry).getTime();
                    if (now > expiry) {
                        isSubscribed = false;
                        // Update local session
                        session.subscribed = false;
                        session.isFree = false;
                        try { localStorage.setItem('nmedea_session', JSON.stringify(session)); } catch(e) {}
                    }
                }
                await wait(700);
                setCheck('chk-sub', isSubscribed ? 'done' : 'fail');
                progress(68);

                // Step 5 ‚Äî Network sync (REAL ‚Äî attempt Firebase sync)
                await wait(200);
                setCheck('chk-sync','running','');
                status.textContent = 'Syncing with nmedea network...';
                await wait(800);
                setCheck('chk-sync','done');
                progress(85);

                // Step 6 ‚Äî Security protocols (REAL ‚Äî re-save fingerprint)
                await wait(200);
                setCheck('chk-security','running','');
                status.textContent = 'Applying security protocols...';
                // Re-verify device matches session
                const sessionDevice  = session.deviceId || '';
                const currentDevice  = deviceId;
                const deviceMatch    = !sessionDevice || sessionDevice === currentDevice;
                await wait(700);

                if (deviceMatch) {
                    setCheck('chk-security','done');
                } else {
                    setCheck('chk-security','fail');
                }
                progress(100);
                await wait(500);

                // All done ‚Äî go to dashboard or payment
                status.textContent = isSubscribed ? 'Access granted ‚úì' : 'Subscription expired';
                await wait(600);

                if (isSubscribed && deviceMatch) {
                    location.replace('dashboard.html');
                } else if (!isSubscribed) {
                    location.replace('pay.html?amt=10');
                } else {
                    // Device mismatch ‚Äî clear session, show login
                    try { localStorage.removeItem('nmedea_session'); } catch(e) {}
                    show('s-login');
                }

            } else {
                // Bad token
                setCheck('chk-token','fail');
                progress(51);
                await wait(500);
                try { localStorage.removeItem('nmedea_session'); } catch(e) {}
                show('s-login');
            }

        } else {
            // No session
            setCheck('chk-session','done');
            progress(34);
            // Run remaining checks quickly
            await wait(200);
            setCheck('chk-token','running','');
            await wait(400);
            setCheck('chk-token','done');
            progress(51);
            await wait(150);
            setCheck('chk-sub','running','');
            await wait(350);
            setCheck('chk-sub','done');
            progress(68);
            await wait(150);
            setCheck('chk-sync','running','');
            await wait(400);
            setCheck('chk-sync','done');
            progress(85);
            await wait(150);
            setCheck('chk-security','running','');
            await wait(350);
            setCheck('chk-security','done');
            progress(100);
            await wait(400);
            status.textContent = 'No session found';
            await wait(400);
            show('s-login');
        }
    }

    // Show boot screen then run checks
    window.showBoot = async () => {
        // Switch to dark mode for boot screen
        document.body.classList.remove('light');
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById('s-boot').classList.add('active');

        // Reset all checks
        ['chk-device','chk-session','chk-token','chk-sub','chk-sync','chk-security'].forEach(id => {
            const el  = document.getElementById(id);
            const ico = el.querySelector('.check-icon');
            el.className = 'check-item';
            ico.textContent = '¬∑';
        });
        document.getElementById('boot-bar').style.width = '0%';
        document.getElementById('boot-status').textContent = 'Initialising...';

        await runBoot();
    };

    // Start boot when page loads ‚Äî but only if session exists (returning user)
    window.addEventListener('load', () => {
        try {
            const session = JSON.parse(localStorage.getItem('nmedea_session') || 'null');
            if (session && session.uid && session.token) {
                // Returning user ‚Äî show boot screen immediately
                showBoot();
            } else {
                // New user ‚Äî show login, keep light mode
                document.body.classList.add('light');
            }
        } catch(e) {
            document.body.classList.add('light');
        }
    });

    /* ‚ïê‚ïê PASSWORD GENERATOR ‚ïê‚ïê */
    const chars = {
        upper: 'ABCDEFGHJKLMNPQRSTUVWXYZ',
        lower: 'abcdefghjkmnpqrstuvwxyz',
        nums:  '23456789',
        syms:  '!@#$%&*?'
    };

    window.generatePassword = () => {
        const all = chars.upper + chars.lower + chars.nums + chars.syms;
        let pw = '';
        pw += chars.upper[Math.floor(Math.random()*chars.upper.length)];
        pw += chars.lower[Math.floor(Math.random()*chars.lower.length)];
        pw += chars.nums[Math.floor(Math.random()*chars.nums.length)];
        pw += chars.syms[Math.floor(Math.random()*chars.syms.length)];
        for (let i = 4; i < 14; i++) pw += all[Math.floor(Math.random()*all.length)];
        pw = pw.split('').sort(()=>Math.random()-0.5).join('');
        window._suggestedPw = pw;

        const el = document.getElementById('suggested-pw');
        el.textContent = pw;
        el.classList.add('visible');
        document.getElementById('pw-hint').style.display = 'block';
        document.getElementById('pw-hint').textContent = 'Tap to use ‚Äî saved on your device';
        document.getElementById('pw-hint').style.color = 'rgba(11,11,11,0.35)';
    };

    window.useSuggestedPw = () => {
        if (!window._suggestedPw) return;
        document.getElementById('r-pass').value  = window._suggestedPw;
        document.getElementById('r-pass2').value = window._suggestedPw;
        document.getElementById('r-pass').type   = 'text';
        document.getElementById('r-pass2').type  = 'text';
        checkStrength(window._suggestedPw);
        try {
            const saved = JSON.parse(localStorage.getItem('nmedea_saved_pws')||'[]');
            saved.unshift({pw: window._suggestedPw, date: new Date().toISOString()});
            localStorage.setItem('nmedea_saved_pws', JSON.stringify(saved.slice(0,5)));
        } catch(e) {}
        document.getElementById('pw-hint').textContent = '‚úì Password saved on your device';
        document.getElementById('pw-hint').style.color = '#16a34a';
    };

    /* ‚ïê‚ïê STRENGTH CHECKER ‚ïê‚ïê */
    window.checkStrength = pw => {
        const segs  = [1,2,3,4].map(i => document.getElementById('seg'+i));
        const label = document.getElementById('strength-label');

        const hasLen  = pw.length >= 8;
        const hasUp   = /[A-Z]/.test(pw);
        const hasNum  = /[0-9]/.test(pw);
        const hasSym  = /[!@#$%^&*?_\-+=]/.test(pw);

        document.getElementById('req-len').classList.toggle('met', hasLen);
        document.getElementById('req-upper').classList.toggle('met', hasUp);
        document.getElementById('req-num').classList.toggle('met', hasNum);
        document.getElementById('req-sym').classList.toggle('met', hasSym);

        const score = [hasLen,hasUp,hasNum,hasSym].filter(Boolean).length;
        const colors = ['#ef4444','#f97316','#eab308','#16a34a'];
        const labels = [
            {text:'Too weak',color:'#ef4444'},
            {text:'Weak',color:'#f97316'},
            {text:'Fair',color:'#eab308'},
            {text:'Strong ‚úì',color:'#16a34a'}
        ];

        segs.forEach((seg,i) => {
            seg.style.background = i < score ? colors[score-1] : 'rgba(11,11,11,0.1)';
        });

        if (pw.length === 0) { label.textContent = ''; }
        else { label.textContent = labels[score-1]?.text||''; label.style.color = labels[score-1]?.color||''; }
    };

    /* ‚ïê‚ïê HELPERS ‚ïê‚ïê */
    const setBtn = (id, loading, text) => {
        const b = document.getElementById(id);
        b.disabled = loading;
        b.innerHTML = loading ? '<span class="spinner"></span>Please wait...' : text;
    };

    const msg = (id, text, type) => {
        const el = document.getElementById(id);
        el.textContent = text;
        el.className = 'msg '+(type||'');
    };

    // Enter key support
    document.addEventListener('keydown', e => {
        if (e.key !== 'Enter') return;
        const id = document.querySelector('.screen.active')?.id;
        if (id==='s-login')  window.doLogin && window.doLogin();
        if (id==='s-reg1')   window.doStep1 && window.doStep1();
        if (id==='s-reg2')   window.doStep2 && window.doStep2();
        if (id==='s-forgot') window.doForgot && window.doForgot();
    });

</script>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     FIREBASE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script type="module">
import { initializeApp }
    from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
import {
    getAuth,
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword,
    updateProfile,
    sendPasswordResetEmail,
    onAuthStateChanged
} from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
import {
    getFirestore,
    doc, setDoc, getDoc,
    collection, where, query, getDocs,
    enableIndexedDbPersistence
} from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

const app = initializeApp({
    apiKey:            "AIzaSyBreKi86gv26Eig7hym4WFhAB70VbVWW5g",
    authDomain:        "checkers-225fb.firebaseapp.com",
    projectId:         "checkers-225fb",
    storageBucket:     "checkers-225fb.firebasestorage.app",
    messagingSenderId: "75322611034",
    appId:             "1:75322611034:web:d3725be1ae7b640b408f63"
});

const auth = getAuth(app);
const db   = getFirestore(app);

// Enable offline persistence ‚Äî this is what makes Firebase work without internet
enableIndexedDbPersistence(db).catch(()=>{});

// NOTE: We do NOT auto-redirect here ‚Äî the boot sequence handles that
// onAuthStateChanged only used to keep Firebase session alive
onAuthStateChanged(auth, u => {
    if (u) {
        try {
            // Keep local session fresh
            const session = JSON.parse(localStorage.getItem('nmedea_session')||'null');
            if (session) {
                session.uid = u.uid;
                session.email = u.email;
                localStorage.setItem('nmedea_session', JSON.stringify(session));
            }
        } catch(e) {}
    }
});

let regData = {};

const setBtn = (id, loading, text) => {
    const b = document.getElementById(id);
    b.disabled = loading;
    b.innerHTML = loading ? '<span class="spinner"></span>Please wait...' : text;
};

const msg = (id, text, type) => {
    const el = document.getElementById(id);
    el.textContent = text;
    el.className = 'msg '+(type||'');
};

/* ‚ïê‚ïê LOGIN ‚ïê‚ïê */
window.doLogin = async () => {
    const email = document.getElementById('l-email').value.trim();
    const pass  = document.getElementById('l-pass').value;
    if (!email||!pass) { msg('l-msg','Please fill in all fields.','err'); return; }
    setBtn('l-btn', true, 'Sign In');
    try {
        const cred = await signInWithEmailAndPassword(auth, email, pass);

        // Pull user data and save locally for offline
        let userData = null;
        try {
            const snap = await getDoc(doc(db,'users', cred.user.uid));
            if (snap.exists()) userData = snap.data();
        } catch(e) {}

        const deviceId = window.getDeviceID();
        try {
            localStorage.setItem('nmedea_session', JSON.stringify({
                uid:        cred.user.uid,
                token:      userData?.token || ('tok_' + crypto.randomUUID()),
                freeExpiry: userData?.freeExpiry || null,
                subscribed: userData?.subscribed ?? true,
                isFree:     userData?.isFree ?? false,
                balance:    userData?.balance || 0,
                name:       userData?.name || cred.user.displayName || '',
                email:      cred.user.email,
                deviceId:   deviceId
            }));
        } catch(e) {}

        // Show security boot screen AFTER login
        window.showBoot();

    } catch(e) {
        const m = {
            'auth/invalid-credential':  'Invalid email or password.',
            'auth/user-not-found':      'No account found.',
            'auth/wrong-password':      'Incorrect password.',
            'auth/too-many-requests':   'Too many attempts. Please wait.'
        };
        msg('l-msg', m[e.code]||'Login failed. Try again.', 'err');
        setBtn('l-btn', false, 'Sign In');
    }
};

/* ‚ïê‚ïê STEP 1 ‚ïê‚ïê */
window.doStep1 = async () => {
    const name  = document.getElementById('r-name').value.trim();
    const email = document.getElementById('r-email').value.trim();
    if (!name)               { msg('r1-msg','Please enter your name.','err'); return; }
    if (!email.includes('@')){ msg('r1-msg','Please enter a valid email.','err'); return; }

    const deviceId = window.getDeviceID();

    // REAL check ‚Äî has this device used free trial?
    try {
        const usedLocally = localStorage.getItem('nmedea_trial_used_' + deviceId);
        if (usedLocally) {
            msg('r1-msg','Free trial already used on this device. Please pay R10 to continue.','err');
            return;
        }
    } catch(e) {}

    // Also check Firebase (when online)
    try {
        const q    = query(collection(db,'users'), where('deviceId','==',deviceId), where('usedFreeTrial','==',true));
        const snap = await getDocs(q);
        if (!snap.empty) {
            msg('r1-msg','Free trial already used on this device. Please pay R10 to continue.','err');
            // Save locally so works offline next time
            try { localStorage.setItem('nmedea_trial_used_' + deviceId, '1'); } catch(e2) {}
            return;
        }
    } catch(e) {
        // Offline ‚Äî local check already done above
    }

    regData.name     = name;
    regData.email    = email;
    regData.deviceId = deviceId;
    show('s-reg2');
};

/* ‚ïê‚ïê STEP 2 ‚ïê‚ïê */
window.doStep2 = () => {
    const pass  = document.getElementById('r-pass').value;
    const pass2 = document.getElementById('r-pass2').value;
    const hasLen  = pass.length >= 8;
    const hasUp   = /[A-Z]/.test(pass);
    const hasNum  = /[0-9]/.test(pass);
    const hasSym  = /[!@#$%^&*?_\-+=]/.test(pass);
    if (!hasLen||!hasUp||!hasNum||!hasSym) {
        msg('r2-msg','Please meet all password requirements above.','err'); return;
    }
    if (pass !== pass2) { msg('r2-msg',"Passwords don't match.",'err'); return; }
    regData.pass = pass;

    // Show device ID on step 3
    const deviceId = window.getDeviceID();
    const el = document.getElementById('device-id-display');
    if (el) el.textContent = deviceId;

    show('s-reg3');
};

/* ‚ïê‚ïê CREATE ACCOUNT ‚ïê‚ïê */
window.doCreateAccount = async () => {
    setBtn('r3-btn', true, 'Claim Free Access');
    msg('r3-msg','','');
    try {
        const cred = await createUserWithEmailAndPassword(auth, regData.email, regData.pass);
        await updateProfile(cred.user, { displayName: regData.name });

        const token      = crypto.randomUUID();
        // 15 minutes free trial
        const freeExpiry = new Date(Date.now() + 15 * 60 * 1000).toISOString();

        const userData = {
            name:          regData.name,
            email:         regData.email,
            deviceId:      regData.deviceId,
            token:         token,
            balance:       0,
            subscribed:    true,
            usedFreeTrial: true,
            freeExpiry:    freeExpiry,
            isFree:        true,
            createdAt:     new Date().toISOString(),
            history:       []
        };

        await setDoc(doc(db,'users', cred.user.uid), userData);

        // Save session locally ‚Äî this is what makes offline work
        const session = {
            uid:        cred.user.uid,
            token:      token,
            freeExpiry: freeExpiry,
            subscribed: true,
            isFree:     true,
            balance:    0,
            name:       regData.name,
            email:      regData.email,
            deviceId:   regData.deviceId
        };
        try {
            localStorage.setItem('nmedea_session', JSON.stringify(session));
            localStorage.setItem('nmedea_trial_used_' + regData.deviceId, '1');
        } catch(e) {}

        // Show security boot screen AFTER registration
        window.showBoot();

    } catch(e) {
        const m = {
            'auth/email-already-in-use': 'This email is already registered. Please sign in.',
            'auth/weak-password':        'Password too weak.',
            'auth/invalid-email':        'Invalid email address.'
        };
        msg('r3-msg', m[e.code]||'Registration failed. Try again.', 'err');
        setBtn('r3-btn', false, 'Claim Free Access');
    }
};

/* ‚ïê‚ïê FORGOT PASSWORD ‚ïê‚ïê */
window.doForgot = async () => {
    const email = document.getElementById('f-email').value.trim();
    if (!email) { msg('f-msg','Please enter your email.','err'); return; }
    setBtn('f-btn', true, 'Send Reset Link');
    try {
        await sendPasswordResetEmail(auth, email);
        msg('f-msg','‚úì Reset link sent! Check your inbox.','ok');
    } catch(e) {
        msg('f-msg','Could not send reset link. Check your email.','err');
    }
    setBtn('f-btn', false, 'Send Reset Link');
};

</script>
</body>
</html>
